TODO

* Polish code up
* Better error handling (especially with checking for NULLs from malloc)