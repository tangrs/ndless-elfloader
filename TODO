TODO

* Polish code up
* Better error handling (especially with checking for NULLs from malloc)
* Make compatible with Ndless 3.1 (see PORTING_TO_NDLESS3.1)